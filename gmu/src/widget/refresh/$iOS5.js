!function(o,e){o.Refresh.register("iOS5",{_init:function(){var o=this,t=o._options,l=o.$el;l.css({overflow:"scroll","-webkit-overflow-scrolling":"touch"}),t.topOffset=t.$upElem?t.$upElem.height():0,t.iScroll=o._getiScroll(),l.get(0).scrollTop=t.topOffset,l.on("touchstart touchmove touchend",e.proxy(o._eventHandler,o))},_changeStyle:function(o,e){var t=this,l=t._options,r=l.refreshInfo[o];switch(t.origin(o,e),e){case"loaded":r.$icon.addClass("ui-refresh-icon"),l._actDir="";break;case"beforeload":r.$label.html("松开立即加载"),r.$icon.addClass("ui-refresh-flip");break;case"loading":r.$icon.removeClass().addClass("ui-loading")}return t},_scrollStart:function(o){var e=this,t=e._options,l=t.topOffset,r=t.$upElem,s=e.$el.get(0),n=function(){clearTimeout(t.topOffsetTimer),r&&r.length&&s.scrollTop<=l&&!t._upRefreshed&&(s.scrollTop=l)};return e.trigger("scrollstart",o),e._enableScroll()._bindScrollStop(s,n),t.maxScrollY=s.offsetHeight-s.scrollHeight,t._scrollFn=n,e},_scrollMove:function(){var o=this,e=o._options,t=e.$upElem&&e.$upElem.length,l=e.$downElem&&e.$downElem.length,r=o.$el.get(0),s=e.threshold||5;o._scrollMove=function(n){var i=e.maxScrollY,c=r.scrollTop,a=e.lastMoveY||c,u=e._upRefreshed,f=e._downRefreshed,p=o._status("up"),_=o._status("down");if(!(t&&!p||l&&!_))return e.iScroll.deltaY=c-a,_&&l&&!f&&i-s>-c?o._setMoveState("down","beforeload","pull"):_&&l&&f&&-c>i-s&&-c!==i?o._setMoveState("down","loaded","restore"):p&&t&&!u&&-c>s?o._setMoveState("up","beforeload","pull"):p&&t&&u&&s>-c&&c&&o._setMoveState("up","loaded","restore"),e.lastMoveY=c,e._moved=!0,o.trigger("scrollmove",n,c,c-a)},o._scrollMove.apply(o,arguments)},_scrollEnd:function(o){var t=this,l=t._options,r=t.$el.get(0),s=l.topOffset,n=l._actDir,i=l._restoreDir;return("up"==i||r.scrollTop<=s)&&!n&&l._moved&&(t._options.topOffsetTimer=setTimeout(function(){e(r).off("scroll",l._scrollFn),r.scrollTop=s},800)),n&&t._status(n)&&(t._setStyle(n,"loading"),t._loadingAction(n,"pull")),l._moved=!1,t.trigger("scrollend",o)},_enableScroll:function(){var o=this,e=o.$el.get(0),t=e.scrollTop;return 0>=t&&(e.scrollTop=1),t+e.offsetHeight>=e.scrollHeight&&(e.scrollTop=e.scrollHeight-e.offsetHeight-1),o},_bindScrollStop:function(o,t){var l=this,r=e(o);return r.off("scroll",l._options._scrollFn).on("scroll",e.debounce(100,function(){r.off("scroll",arguments.callee).one("scroll",t)},!1)),l},_getiScroll:function(){var o=this,e=o.$el,t=e[0];return{el:t,deltaY:0,scrollTo:function(o,l,r){r&&(o=t.scrollTop+o),e.css({"-webkit-transition-property":"scrollTop","-webkit-transition-duration":o+"ms"}),t.scrollTop=o},disable:function(t){t&&o.destroy(),e.css("overflow","hidden")},enable:function(){e.css("overflow","scroll")}}},_setMoveState:function(o,e,t){var l=this,r=l._options;return l._setStyle(o,e),r["_"+o+"Refreshed"]="pull"==t,r._actDir="pull"==t?o:"",r._restoreDir="up"==o&&"restore"==t?o:"",l},_eventHandler:function(o){var e=this;switch(o.type){case"touchstart":e._scrollStart(o);break;case"touchmove":e._scrollMove(o);break;case"touchend":e._scrollEnd(o)}},afterDataLoading:function(o){var e=this,t=e._options,o=o||t._actDir;return t["_"+o+"Refreshed"]=!1,"up"==o&&(e.$el.get(0).scrollTop=t.topOffset),e.origin(o)}})}(gmu,gmu.$);