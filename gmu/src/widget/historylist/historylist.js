!function(t,e){t.define("Historylist",{options:{container:document.body,deleteSupport:!0,items:[]},template:{wrap:'<ul class="ui-historylist">',item:'<li data-id="<%=id%>"><p class="ui-historylist-itemwrap"><span class="ui-historylist-item"><%=context%></span></p></li>',clear:'<p class="ui-historylist-clear">清空搜索历史</p>'},_init:function(){var t=this,e=t._options;t.$el=e.container=e.container||document.body,t.items=[],t.on("ready",function(){t._bindUI()}),t.on("itemDelete",function(){0===t.items.length&&t.hide()})},_create:function(){var t=this,i=t._options;t.$el.hide(),t.$wrap=e(t.tpl2html("wrap")).appendTo(i.container),t.$clear=e(t.tpl2html("clear")).appendTo(i.container),!t._options.deleteSupport&&t.$clear.hide(),t.addItems(i.items),t.show()},_filterItemsById:function(t,e){var i=this;i.items.forEach(function(n,s){return n.id===t?(e.call(i,n,s),void 0):void 0})},_bindUI:function(){var i,n,s,r,o,a,l,c,u,p,d,h,m,f,v=this,w=!1;v.$clear.on("tap"+v.eventNs,function(e){setTimeout(function(){t.Dialog({closeBtn:!1,buttons:{"清空":function(){v.clear(),this.destroy()},"取消":function(){this.destroy()}},title:"清空历史",content:"<p>是否清空搜索历史？</p>",open:function(){this._options._wrap.addClass("ui-historylist-dialog")}})},10),e.preventDefault(),e.stopPropagation()}),v.$wrap.on("tap"+v.eventNs,function(t){if(!v._options.deleteSupport){if(n=e(t.target),!n.hasClass("ui-historylist-itemwrap")&&!(n=n.parents(".ui-historylist-itemwrap")).length)return n=null,void 0;s=n.parent().attr("data-id"),v._filterItemsById(s,function(t){v.trigger("itemTouch",{item:t.value})})}}),v.$wrap.on("touchstart"+v.eventNs,function(t){if(v._options.deleteSupport){if(i=t.touches[0],n=e(i.target),r=t.timeStamp,c=l=parseInt(i.pageX),p=u=parseInt(i.pageY),m=!1,w=!1,!n.hasClass("ui-historylist-itemwrap")&&!(n=n.parents(".ui-historylist-itemwrap")).length)return n=null,void 0;n.addClass("ui-historylist-ontap"),n.css("width",n.width()-parseInt(n.css("border-left-width"))-parseInt(n.css("border-right-width")))}}),v.$wrap.on("touchmove"+v.eventNs,function(t){if(n){if(c=t.touches[0].pageX,p=t.touches[0].pageY,void 0===a&&(a=setTimeout(function(){w=Math.abs(p-u)>Math.abs(c-l)/2?!1:!0},10)),m=m||(c-l>=3||p-u>=3?!0:!1),!w)return setTimeout(function(){n&&n.removeClass("ui-historylist-ontap")},150),void 0;h=(c-l)/v.$wrap.width(),n.addClass("ui-historylist-itemmoving"),n.removeClass("ui-historylist-ontap"),n.css("-webkit-transform","translate3d("+(c-l)+"px, 0, 0)"),n.css("opacity",1-h),t.preventDefault(),t.stopPropagation()}}),v.$wrap.on("touchend"+v.eventNs+" touchcancel"+v.eventNs,function(t){n&&(clearTimeout(a),a=void 0,s=n.parent().attr("data-id"),o=t.timeStamp,d=(c-l)/(o-r),f=Math.abs(c-l),n.removeClass("ui-historylist-ontap"),n.removeClass("ui-historylist-itemmoving"),f<v.$wrap.width()/3&&Math.abs(d)>.1&&w||f>=v.$wrap.width()/3&&w?v.removeItem(s,n):(n.css("width","auto"),n.css("-webkit-transform","translate3d(0, 0, 0)"),n.css("opacity",1),!m&&3>f&&v._filterItemsById(s,function(t){v.trigger("itemTouch",{item:t.value})})),n=null)})},show:function(){var t=this;if(0!==t.items.length)return t.sync===!1&&(t.$wrap.html(""),t.addItems(t.syncitems),t.sync=!0),t.$el.show(),t.isShow=!0,t},hide:function(){var t=this;return t.$el.hide(),t.isShow=!1,t},_getItemId:function(){var t=this;return void 0===t._itemId?t._itemId=1:++t._itemId,"__dd__"+t._itemId},_getFormatItem:function(t){var e=this;return"[object String]"===Object.prototype.toString.call(t)?{context:t,value:t,id:e._getItemId()}:{context:t.context||t.value,value:t.value||t.context,id:e._getItemId()}},addItem:function(t){var i=this,t=i._getFormatItem(t);return i.items.forEach(function(n,s){return n.value===t.value?(i.items.splice(s,1),e(i.$wrap.children()[s]).remove(),void 0):void 0}),0===i.$wrap.children().length?i.$wrap.append(i.tpl2html("item",t)):e(i.tpl2html("item",t)).insertBefore(i.$wrap.children()[0]),i.items.unshift(t),i},addItems:function(t){var e=this;return t.forEach(function(t){e.addItem(t)}),e},update:function(t){var e=this;return e.isShow?(e.$wrap.html(""),e.addItems(t),e.sync=!0):(e.syncitems=t,e.sync=!1),e},removeItem:function(t,e){var i,n,s,r=this;n=e.css("-webkit-transform"),s=/translate3d\((.*?),.*/.test(n)?RegExp.$1:0,i=parseInt(s,10)>=0?e.width():-e.width(),e.css("-webkit-transform","translate3d("+i+"px, 0, 0)"),e.on("transitionEnd"+r.eventNs+" webkitTransitionEnd"+r.eventNs,function(){e.parent().remove(),r._filterItemsById(t,function(t,e){r.items.splice(e,1),r.trigger("itemDelete",{item:t.value})})})},clear:function(){var t=this;return t.$wrap.html(""),t.items=[],t.sync=!0,t.hide(),t.trigger("clear"),t},disableDelete:function(){var t=this;return t._options.deleteSupport=!1,t.$clear.hide(),t},enableDelete:function(){var t=this;return t._options.deleteSupport=!0,t.$clear.show(),t},destroy:function(){var t=this;return t.$wrap.off(t.eventNs),t.$clear.off(t.eventNs),t.$wrap.remove(),t.$clear.remove(),t.$super("destroy")}})}(gmu,gmu.$);